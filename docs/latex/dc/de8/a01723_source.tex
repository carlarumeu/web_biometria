\doxysubsection{iconv-\/lite/encodings/dbcs-\/codec.js}
\hypertarget{a01723_source}{}\label{a01723_source}\index{dbcs-\/codec.js@{dbcs-\/codec.js}}
\mbox{\hyperlink{a01723}{Ir a la documentaci√≥n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{a01723_source_l00001}\mbox{\hyperlink{a01723_ae2475e10618961c050dcba04e8c42331_ae2475e10618961c050dcba04e8c42331}{00001}}\ \textcolor{stringliteral}{"{}use\ strict"{}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00002}\mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{00002}}\ var\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}\ =\ require(\textcolor{stringliteral}{"{}safer-\/buffer"{}}).Buffer;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00004}00004\ \textcolor{comment}{//\ Multibyte\ codec.\ In\ this\ scheme,\ a\ character\ is\ represented\ by\ 1\ or\ more\ bytes.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00005}00005\ \textcolor{comment}{//\ Our\ codec\ supports\ UTF-\/16\ surrogates,\ extensions\ for\ GB18030\ and\ unicode\ sequences.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00006}00006\ \textcolor{comment}{//\ To\ save\ memory\ and\ loading\ time,\ we\ read\ table\ files\ only\ when\ requested.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00007}00007\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00008}\mbox{\hyperlink{a01723_a2a54c9dab149aa16455f2038c1d5bacb_a2a54c9dab149aa16455f2038c1d5bacb}{00008}}\ \mbox{\hyperlink{a01102_aa4072ba4b6b56b0fb6f4801f17ab2b34_aa4072ba4b6b56b0fb6f4801f17ab2b34}{exports}}.\_dbcs\ =\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00010}\mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{00010}}\ var\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}}\ =\ -\/1,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00011}\mbox{\hyperlink{a01723_a50c7ef8c234abc12a6c40213ba962253_a50c7ef8c234abc12a6c40213ba962253}{00011}}\ \ \ \ \ \mbox{\hyperlink{a01723_a50c7ef8c234abc12a6c40213ba962253_a50c7ef8c234abc12a6c40213ba962253}{GB18030\_CODE}}\ =\ -\/2,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00012}\mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{00012}}\ \ \ \ \ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}\ \ =\ -\/10,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00013}\mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{00013}}\ \ \ \ \ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ =\ -\/1000,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00014}\mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{00014}}\ \ \ \ \ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}\ =\ \textcolor{keyword}{new}\ Array(0x100),}
\DoxyCodeLine{\Hypertarget{a01723_source_l00015}\mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{00015}}\ \ \ \ \ \mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{DEF\_CHAR}}\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00017}00017\ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <\ 0x100;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00018}00018\ \ \ \ \ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]\ =\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00021}00021\ \textcolor{comment}{//\ Class\ DBCSCodec\ reads\ and\ initializes\ mapping\ tables.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00022}\mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{00022}}\ \textcolor{keyword}{function}\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}(codecOptions,\ \mbox{\hyperlink{a01234_a5c062989a80f49a2caf367fe212f6b52_a5c062989a80f49a2caf367fe212f6b52}{iconv}})\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00023}00023\ \ \ \ \ this.encodingName\ =\ codecOptions.encodingName;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00024}00024\ \ \ \ \ \textcolor{keywordflow}{if}\ (!codecOptions)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00025}00025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}DBCS\ codec\ is\ called\ without\ the\ data."{}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00026}00026\ \ \ \ \ \textcolor{keywordflow}{if}\ (!codecOptions.table)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00027}00027\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}Encoding\ '"{}}\ +\ this.encodingName\ +\ \textcolor{stringliteral}{"{}'\ has\ no\ data."{}});}
\DoxyCodeLine{\Hypertarget{a01723_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00029}00029\ \ \ \ \ \textcolor{comment}{//\ Load\ tables.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00030}00030\ \ \ \ \ var\ mappingTable\ =\ codecOptions.table();}
\DoxyCodeLine{\Hypertarget{a01723_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00033}00033\ \ \ \ \ \textcolor{comment}{//\ Decode\ tables:\ MBCS\ -\/>\ Unicode.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00035}00035\ \ \ \ \ \textcolor{comment}{//\ decodeTables\ is\ a\ trie,\ encoded\ as\ an\ array\ of\ arrays\ of\ integers.\ Internal\ arrays\ are\ trie\ nodes\ and\ all\ have\ len\ =\ 256.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00036}00036\ \ \ \ \ \textcolor{comment}{//\ Trie\ root\ is\ decodeTables[0].}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00037}00037\ \ \ \ \ \textcolor{comment}{//\ Values:\ >=\ \ 0\ -\/>\ unicode\ character\ code.\ can\ be\ >\ 0xFFFF}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00038}00038\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ==\ UNASSIGNED\ -\/>\ unknown/unassigned\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00039}00039\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ==\ GB18030\_CODE\ -\/>\ this\ is\ the\ end\ of\ a\ GB18030\ 4-\/byte\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00040}00040\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ <=\ NODE\_START\ -\/>\ index\ of\ the\ next\ node\ in\ our\ trie\ to\ process\ next\ byte.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00041}00041\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ <=\ SEQ\_START\ \ -\/>\ index\ of\ the\ start\ of\ a\ character\ code\ sequence,\ in\ decodeTableSeq.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00042}00042\ \ \ \ \ this.decodeTables\ =\ [];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00043}00043\ \ \ \ \ this.decodeTables[0]\ =\ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}.slice(0);\ \textcolor{comment}{//\ Create\ root\ node.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00045}00045\ \ \ \ \ \textcolor{comment}{//\ Sometimes\ a\ MBCS\ char\ corresponds\ to\ a\ sequence\ of\ unicode\ chars.\ We\ store\ them\ as\ arrays\ of\ integers\ here.\ }}
\DoxyCodeLine{\Hypertarget{a01723_source_l00046}00046\ \ \ \ \ this.decodeTableSeq\ =\ [];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00048}00048\ \ \ \ \ \textcolor{comment}{//\ Actual\ mapping\ tables\ consist\ of\ chunks.\ Use\ them\ to\ fill\ up\ decode\ tables.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00049}00049\ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <\ mappingTable.length;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00050}00050\ \ \ \ \ \ \ \ \ this.\_addDecodeChunk(mappingTable[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00052}00052\ \ \ \ \ this.\mbox{\hyperlink{a01234_a03ca51949015b7c9734fd87bf26de60a_a03ca51949015b7c9734fd87bf26de60a}{defaultCharUnicode}}\ =\ \mbox{\hyperlink{a01234_a5c062989a80f49a2caf367fe212f6b52_a5c062989a80f49a2caf367fe212f6b52}{iconv}}.defaultCharUnicode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00054}00054\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00055}00055\ \ \ \ \ \textcolor{comment}{//\ Encode\ tables:\ Unicode\ -\/>\ DBCS.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00057}00057\ \ \ \ \ \textcolor{comment}{//\ \`{}encodeTable`\ is\ array\ mapping\ from\ unicode\ char\ to\ encoded\ char.\ All\ its\ values\ are\ integers\ for\ performance.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00058}00058\ \ \ \ \ \textcolor{comment}{//\ Because\ it\ can\ be\ sparse,\ it\ is\ represented\ as\ array\ of\ buckets\ by\ 256\ chars\ each.\ Bucket\ can\ be\ null.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00059}00059\ \ \ \ \ \textcolor{comment}{//\ Values:\ >=\ \ 0\ -\/>\ it\ is\ a\ normal\ char.\ Write\ the\ value\ (if\ <=256\ then\ 1\ byte,\ if\ <=65536\ then\ 2\ bytes,\ etc.).}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00060}00060\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ==\ UNASSIGNED\ -\/>\ no\ conversion\ found.\ Output\ a\ default\ char.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00061}00061\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ <=\ SEQ\_START\ \ -\/>\ it's\ an\ index\ in\ encodeTableSeq,\ see\ below.\ The\ character\ starts\ a\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00062}00062\ \ \ \ \ this.encodeTable\ =\ [];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00063}00063\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00064}00064\ \ \ \ \ \textcolor{comment}{//\ \`{}encodeTableSeq`\ is\ used\ when\ a\ sequence\ of\ unicode\ characters\ is\ encoded\ as\ a\ single\ code.\ We\ use\ a\ tree\ of}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00065}00065\ \ \ \ \ \textcolor{comment}{//\ objects\ where\ keys\ correspond\ to\ characters\ in\ sequence\ and\ leafs\ are\ the\ encoded\ dbcs\ values.\ A\ special\ DEF\_CHAR\ key}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00066}00066\ \ \ \ \ \textcolor{comment}{//\ means\ end\ of\ sequence\ (needed\ when\ one\ sequence\ is\ a\ strict\ subsequence\ of\ another).}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00067}00067\ \ \ \ \ \textcolor{comment}{//\ Objects\ are\ kept\ separately\ from\ encodeTable\ to\ increase\ performance.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00068}00068\ \ \ \ \ this.encodeTableSeq\ =\ [];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00070}00070\ \ \ \ \ \textcolor{comment}{//\ Some\ chars\ can\ be\ decoded,\ but\ need\ not\ be\ encoded.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00071}00071\ \ \ \ \ var\ skipEncodeChars\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00072}00072\ \ \ \ \ \textcolor{keywordflow}{if}\ (codecOptions.encodeSkipVals)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00073}00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <\ codecOptions.encodeSkipVals.length;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ var\ val\ =\ codecOptions.encodeSkipVals[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (typeof\ val\ ===\ \textcolor{stringliteral}{'number'})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ skipEncodeChars[val]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ =\ val.from;\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ <=\ val.to;\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ skipEncodeChars[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00080}00080\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00081}00081\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00082}00082\ \ \ \ \ \textcolor{comment}{//\ Use\ decode\ trie\ to\ recursively\ fill\ out\ encode\ tables.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00083}00083\ \ \ \ \ this.\_fillEncodeTable(0,\ 0,\ skipEncodeChars);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00084}00084\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00085}00085\ \ \ \ \ \textcolor{comment}{//\ Add\ more\ encoding\ pairs\ when\ needed.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00086}00086\ \ \ \ \ \textcolor{keywordflow}{if}\ (codecOptions.encodeAdd)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00087}00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ uChar\ \mbox{\hyperlink{a01195_aaf64ea1eb68af5440a0249f7788f1af5_aaf64ea1eb68af5440a0249f7788f1af5}{in}}\ codecOptions.encodeAdd)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Object.prototype.hasOwnProperty.call(codecOptions.encodeAdd,\ uChar))}
\DoxyCodeLine{\Hypertarget{a01723_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this.\_setEncodeChar(uChar.charCodeAt(0),\ codecOptions.encodeAdd[uChar]);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00090}00090\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00091}00091\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00092}00092\ \ \ \ \ this.defCharSB\ \ =\ this.encodeTable[0][\mbox{\hyperlink{a01234_a5c062989a80f49a2caf367fe212f6b52_a5c062989a80f49a2caf367fe212f6b52}{iconv}}.defaultCharSingleByte.charCodeAt(0)];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00093}00093\ \ \ \ \ \textcolor{keywordflow}{if}\ (this.defCharSB\ ===\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})\ this.defCharSB\ =\ this.encodeTable[0][\textcolor{charliteral}{'?'}];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00094}00094\ \ \ \ \ \textcolor{keywordflow}{if}\ (this.defCharSB\ ===\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})\ this.defCharSB\ =\ \textcolor{stringliteral}{"{}?"{}}.charCodeAt(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00095}00095\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00097}00097\ \ \ \ \ \textcolor{comment}{//\ Load\ \&\ create\ GB18030\ tables\ when\ needed.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00098}00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (typeof\ codecOptions.gb18030\ ===\ \textcolor{stringliteral}{'function'})\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00099}00099\ \ \ \ \ \ \ \ \ this.gb18030\ =\ codecOptions.gb18030();\ \textcolor{comment}{//\ Load\ GB18030\ ranges.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00101}00101\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ GB18030\ decode\ tables.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00102}00102\ \ \ \ \ \ \ \ \ var\ thirdByteNodeIdx\ =\ this.decodeTables.length;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00103}00103\ \ \ \ \ \ \ \ \ var\ thirdByteNode\ =\ this.decodeTables[thirdByteNodeIdx]\ =\ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}.slice(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00105}00105\ \ \ \ \ \ \ \ \ var\ fourthByteNodeIdx\ =\ this.decodeTables.length;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00106}00106\ \ \ \ \ \ \ \ \ var\ fourthByteNode\ =\ this.decodeTables[fourthByteNodeIdx]\ =\ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}.slice(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00107}00107\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00108}00108\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0x81;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <=\ 0xFE;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00109}00109\ \ \ \ \ \ \ \ \ \ \ \ \ var\ secondByteNodeIdx\ =\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ this.decodeTables[0][\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ var\ secondByteNode\ =\ this.decodeTables[secondByteNodeIdx];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ =\ 0x30;\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ <=\ 0x39;\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ secondByteNode[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}]\ =\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ thirdByteNodeIdx;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00113}00113\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0x81;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <=\ 0xFE;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ thirdByteNode[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]\ =\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ fourthByteNodeIdx;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00116}00116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0x30;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <=\ 0x39;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ fourthByteNode[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]\ =\ \mbox{\hyperlink{a01723_a50c7ef8c234abc12a6c40213ba962253_a50c7ef8c234abc12a6c40213ba962253}{GB18030\_CODE}}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00118}00118\ \ \ \ \ \}\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00119}00119\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00120}00120\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00121}\mbox{\hyperlink{a01723_a2e3d2e577cc69881c4ec00c7b8005e35_a2e3d2e577cc69881c4ec00c7b8005e35}{00121}}\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.encoder\ =\ DBCSEncoder;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00122}\mbox{\hyperlink{a01723_ad3d625998d0232650afb4cf3c50dc9f1_ad3d625998d0232650afb4cf3c50dc9f1}{00122}}\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.decoder\ =\ \mbox{\hyperlink{a01723_aa111899b7d948e60b1d84783a493a3e3_aa111899b7d948e60b1d84783a493a3e3}{DBCSDecoder}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00124}00124\ \textcolor{comment}{//\ Decoder\ helpers}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00125}\mbox{\hyperlink{a01723_a3628692f27c06944c2abe51472c681fd_a3628692f27c06944c2abe51472c681fd}{00125}}\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.\_getDecodeTrieNode\ =\ \textcolor{keyword}{function}(addr)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00126}00126\ \ \ \ \ var\ \mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}\ =\ [];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00127}00127\ \ \ \ \ \textcolor{keywordflow}{for}\ (;\ addr\ >\ 0;\ addr\ >>=\ 8)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00128}00128\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}.push(addr\ \&\ 0xFF);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00129}00129\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}.length\ ==\ 0)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00130}00130\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}.push(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00132}00132\ \ \ \ \ var\ node\ =\ this.decodeTables[0];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00133}00133\ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ \mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}.length-\/1;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ >\ 0;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}-\/-\/)\ \{\ \textcolor{comment}{//\ Traverse\ nodes\ deeper\ into\ the\ trie.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00134}00134\ \ \ \ \ \ \ \ \ var\ val\ =\ node[\mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00135}00135\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00136}00136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (val\ ==\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})\ \{\ \textcolor{comment}{//\ Create\ new\ node.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ node[\mbox{\hyperlink{a01108_adeb1431b84efe09355bbd01e42326838_adeb1431b84efe09355bbd01e42326838}{bytes}}[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]]\ =\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ this.decodeTables.length;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ this.decodeTables.push(node\ =\ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}.slice(0));}
\DoxyCodeLine{\Hypertarget{a01723_source_l00139}00139\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00140}00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (val\ <=\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}})\ \{\ \textcolor{comment}{//\ Existing\ node.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ node\ =\ this.decodeTables[\mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ val];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00142}00142\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00143}00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}Overwrite\ byte\ in\ "{}}\ +\ this.encodingName\ +\ \textcolor{stringliteral}{"{},\ addr:\ "{}}\ +\ addr.toString(16));}
\DoxyCodeLine{\Hypertarget{a01723_source_l00145}00145\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00146}00146\ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00147}00147\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00148}00148\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00150}00150\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.\_addDecodeChunk\ =\ \textcolor{keyword}{function}(chunk)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00151}00151\ \ \ \ \ \textcolor{comment}{//\ First\ element\ of\ chunk\ is\ the\ hex\ mbcs\ code\ where\ we\ start.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00152}00152\ \ \ \ \ var\ curAddr\ =\ parseInt(chunk[0],\ 16);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00154}00154\ \ \ \ \ \textcolor{comment}{//\ Choose\ the\ decoding\ node\ where\ we'll\ write\ our\ chars.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00155}00155\ \ \ \ \ var\ writeTable\ =\ this.\mbox{\hyperlink{a01723_a3628692f27c06944c2abe51472c681fd_a3628692f27c06944c2abe51472c681fd}{\_getDecodeTrieNode}}(curAddr);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00156}00156\ \ \ \ \ curAddr\ =\ curAddr\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00157}00157\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00158}00158\ \ \ \ \ \textcolor{comment}{//\ Write\ all\ other\ elements\ of\ the\ chunk\ to\ the\ table.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00159}00159\ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ k\ =\ 1;\ k\ <\ chunk.length;\ k++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00160}00160\ \ \ \ \ \ \ \ \ var\ part\ =\ chunk[k];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00161}00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (typeof\ part\ ===\ \textcolor{stringliteral}{"{}string"{}})\ \{\ \textcolor{comment}{//\ String,\ write\ as-\/is.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00162}00162\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ =\ 0;\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ <\ part.length;)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ code\ =\ part.charCodeAt(\mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}++);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (0xD800\ <=\ code\ \&\&\ code\ <\ 0xDC00)\ \{\ \textcolor{comment}{//\ Decode\ surrogate}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00165}00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ codeTrail\ =\ part.charCodeAt(\mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}++);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00166}00166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (0xDC00\ <=\ codeTrail\ \&\&\ codeTrail\ <\ 0xE000)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00167}00167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ writeTable[curAddr++]\ =\ 0x10000\ +\ (code\ -\/\ 0xD800)\ *\ 0x400\ +\ (codeTrail\ -\/\ 0xDC00);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00168}00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00169}00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}Incorrect\ surrogate\ pair\ in\ "{}}\ \ +\ this.encodingName\ +\ \textcolor{stringliteral}{"{}\ at\ chunk\ "{}}\ +\ chunk[0]);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00170}00170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (0x0FF0\ <\ code\ \&\&\ code\ <=\ 0x0FFF)\ \{\ \textcolor{comment}{//\ Character\ sequence\ (our\ own\ encoding\ used)}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ len\ =\ 0xFFF\ -\/\ code\ +\ 2;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ seq\ =\ [];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a01264_a9e77e016b2928d7dcb493b89a0c9dc32_a9e77e016b2928d7dcb493b89a0c9dc32}{m}}\ =\ 0;\ \mbox{\hyperlink{a01264_a9e77e016b2928d7dcb493b89a0c9dc32_a9e77e016b2928d7dcb493b89a0c9dc32}{m}}\ <\ len;\ \mbox{\hyperlink{a01264_a9e77e016b2928d7dcb493b89a0c9dc32_a9e77e016b2928d7dcb493b89a0c9dc32}{m}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seq.push(part.charCodeAt(\mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}++));\ \textcolor{comment}{//\ Simple\ variation:\ don't\ support\ surrogates\ or\ subsequences\ in\ seq.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00176}00176\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00177}00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ writeTable[curAddr++]\ =\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}\ -\/\ this.decodeTableSeq.length;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this.decodeTableSeq.push(seq);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ writeTable[curAddr++]\ =\ code;\ \textcolor{comment}{//\ Basic\ char}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00182}00182\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00183}00183\ \ \ \ \ \ \ \ \ \}\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00184}00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (typeof\ part\ ===\ \textcolor{stringliteral}{"{}number"{}})\ \{\ \textcolor{comment}{//\ Integer,\ meaning\ increasing\ sequence\ starting\ with\ prev\ character.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ var\ charCode\ =\ writeTable[curAddr\ -\/\ 1]\ +\ 1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ =\ 0;\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ <\ part;\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}++)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ writeTable[curAddr++]\ =\ charCode++;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00188}00188\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00189}00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}Incorrect\ type\ '"{}}\ +\ typeof\ part\ +\ \textcolor{stringliteral}{"{}'\ given\ in\ "{}}\ \ +\ this.encodingName\ +\ \textcolor{stringliteral}{"{}\ at\ chunk\ "{}}\ +\ chunk[0]);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00191}00191\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00192}00192\ \ \ \ \ \textcolor{keywordflow}{if}\ (curAddr\ >\ 0xFF)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00193}00193\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}Incorrect\ chunk\ in\ "{}}\ \ +\ this.encodingName\ +\ \textcolor{stringliteral}{"{}\ at\ addr\ "{}}\ +\ chunk[0]\ +\ \textcolor{stringliteral}{"{}:\ too\ long"{}}\ +\ curAddr);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00194}00194\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00195}00195\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00196}00196\ \textcolor{comment}{//\ Encoder\ helpers}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00197}00197\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.\_getEncodeBucket\ =\ \textcolor{keyword}{function}(uCode)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00198}00198\ \ \ \ \ var\ high\ =\ uCode\ >>\ 8;\ \textcolor{comment}{//\ This\ could\ be\ >\ 0xFF\ because\ of\ astral\ characters.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00199}00199\ \ \ \ \ \textcolor{keywordflow}{if}\ (this.encodeTable[high]\ ===\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00200}00200\ \ \ \ \ \ \ \ \ this.encodeTable[high]\ =\ \mbox{\hyperlink{a01723_a8fa1a818b391ca576ea9c87f631edc5c_a8fa1a818b391ca576ea9c87f631edc5c}{UNASSIGNED\_NODE}}.slice(0);\ \textcolor{comment}{//\ Create\ bucket\ on\ demand.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00201}00201\ \ \ \ \ \textcolor{keywordflow}{return}\ this.encodeTable[high];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00202}00202\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00203}00203\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00204}00204\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.\_setEncodeChar\ =\ \textcolor{keyword}{function}(uCode,\ dbcsCode)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00205}00205\ \ \ \ \ var\ bucket\ =\ this.\_getEncodeBucket(uCode);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00206}00206\ \ \ \ \ var\ low\ =\ uCode\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00207}00207\ \ \ \ \ \textcolor{keywordflow}{if}\ (bucket[low]\ <=\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00208}00208\ \ \ \ \ \ \ \ \ this.encodeTableSeq[\mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}-\/bucket[low]][\mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{DEF\_CHAR}}]\ =\ dbcsCode;\ \textcolor{comment}{//\ There's\ already\ a\ sequence,\ set\ a\ single-\/char\ subsequence\ of\ it.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00209}00209\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bucket[low]\ ==\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00210}00210\ \ \ \ \ \ \ \ \ bucket[low]\ =\ dbcsCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00211}00211\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00212}00212\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00213}00213\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.\_setEncodeSequence\ =\ \textcolor{keyword}{function}(seq,\ dbcsCode)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00214}00214\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00215}00215\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ root\ of\ character\ tree\ according\ to\ first\ character\ of\ the\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00216}00216\ \ \ \ \ var\ uCode\ =\ seq[0];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00217}00217\ \ \ \ \ var\ bucket\ =\ this.\_getEncodeBucket(uCode);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00218}00218\ \ \ \ \ var\ low\ =\ uCode\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00220}00220\ \ \ \ \ var\ node;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00221}00221\ \ \ \ \ \textcolor{keywordflow}{if}\ (bucket[low]\ <=\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}})\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00222}00222\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There's\ already\ a\ sequence\ with\ \ -\/\ use\ it.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00223}00223\ \ \ \ \ \ \ \ \ node\ =\ this.encodeTableSeq[\mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}-\/bucket[low]];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00224}00224\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00225}00225\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00226}00226\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ was\ no\ sequence\ object\ -\/\ allocate\ a\ new\ one.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00227}00227\ \ \ \ \ \ \ \ \ node\ =\ \{\};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00228}00228\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bucket[low]\ !==\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})\ node[\mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{DEF\_CHAR}}]\ =\ bucket[low];\ \textcolor{comment}{//\ If\ a\ char\ was\ set\ before\ -\/\ make\ it\ a\ single-\/char\ subsequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00229}00229\ \ \ \ \ \ \ \ \ bucket[low]\ =\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}\ -\/\ this.encodeTableSeq.length;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00230}00230\ \ \ \ \ \ \ \ \ this.encodeTableSeq.push(node);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00231}00231\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00232}00232\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00233}00233\ \ \ \ \ \textcolor{comment}{//\ Traverse\ the\ character\ tree,\ allocating\ new\ nodes\ as\ needed.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00234}00234\ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ =\ 1;\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ <\ seq.length-\/1;\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00235}00235\ \ \ \ \ \ \ \ \ var\ oldVal\ =\ node[uCode];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00236}00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (typeof\ oldVal\ ===\ \textcolor{stringliteral}{'object'})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00237}00237\ \ \ \ \ \ \ \ \ \ \ \ \ node\ =\ oldVal;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00238}00238\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00239}00239\ \ \ \ \ \ \ \ \ \ \ \ \ node\ =\ node[uCode]\ =\ \{\}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00240}00240\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (oldVal\ !==\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00241}00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ node[\mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{DEF\_CHAR}}]\ =\ oldVal}
\DoxyCodeLine{\Hypertarget{a01723_source_l00242}00242\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00243}00243\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00244}00244\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00245}00245\ \ \ \ \ \textcolor{comment}{//\ Set\ the\ leaf\ to\ given\ dbcsCode.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00246}00246\ \ \ \ \ uCode\ =\ seq[seq.length-\/1];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00247}00247\ \ \ \ \ node[uCode]\ =\ dbcsCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00248}00248\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00249}00249\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00250}00250\ \mbox{\hyperlink{a01723_ae1aa3dc81117248270f3744a0eac6e5e_ae1aa3dc81117248270f3744a0eac6e5e}{DBCSCodec}}.prototype.\_fillEncodeTable\ =\ \textcolor{keyword}{function}(nodeIdx,\ prefix,\ skipEncodeChars)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00251}00251\ \ \ \ \ var\ node\ =\ this.decodeTables[nodeIdx];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00252}00252\ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <\ 0x100;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00253}00253\ \ \ \ \ \ \ \ \ var\ uCode\ =\ node[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00254}00254\ \ \ \ \ \ \ \ \ var\ mbCode\ =\ prefix\ +\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00255}00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (skipEncodeChars[mbCode])}
\DoxyCodeLine{\Hypertarget{a01723_source_l00256}00256\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00257}00257\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00258}00258\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uCode\ >=\ 0)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00259}00259\ \ \ \ \ \ \ \ \ \ \ \ \ this.\_setEncodeChar(uCode,\ mbCode);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00260}00260\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ <=\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00261}00261\ \ \ \ \ \ \ \ \ \ \ \ \ this.\_fillEncodeTable(\mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ uCode,\ mbCode\ <<\ 8,\ skipEncodeChars);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00262}00262\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ <=\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00263}00263\ \ \ \ \ \ \ \ \ \ \ \ \ this.\_setEncodeSequence(this.decodeTableSeq[\mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}\ -\/\ uCode],\ mbCode);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00264}00264\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00265}00265\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00266}00266\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00267}00267\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00268}00268\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00269}00269\ \textcolor{comment}{//\ ==\ Encoder\ ==================================================================}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00271}00271\ \textcolor{keyword}{function}\ DBCSEncoder(options,\ codec)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00272}00272\ \ \ \ \ \textcolor{comment}{//\ Encoder\ state}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00273}00273\ \ \ \ \ this.leadSurrogate\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00274}00274\ \ \ \ \ this.seqObj\ =\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00275}00275\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00276}00276\ \ \ \ \ \textcolor{comment}{//\ Static\ data}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00277}00277\ \ \ \ \ this.encodeTable\ =\ codec.encodeTable;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00278}00278\ \ \ \ \ this.encodeTableSeq\ =\ codec.encodeTableSeq;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00279}00279\ \ \ \ \ this.\mbox{\hyperlink{a01234_aeffa94a3dfe04104b28251048d914570_aeffa94a3dfe04104b28251048d914570}{defaultCharSingleByte}}\ =\ codec.defCharSB;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00280}00280\ \ \ \ \ this.gb18030\ =\ codec.gb18030;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00281}00281\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00282}00282\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00283}00283\ DBCSEncoder.prototype.write\ =\ \textcolor{keyword}{function}(str)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00284}00284\ \ \ \ \ var\ newBuf\ =\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}.alloc(str.length\ *\ (\textcolor{keyword}{this}.gb18030\ ?\ 4\ :\ 3)),}
\DoxyCodeLine{\Hypertarget{a01723_source_l00285}00285\ \ \ \ \ \ \ \ \ leadSurrogate\ =\ this.leadSurrogate,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00286}00286\ \ \ \ \ \ \ \ \ seqObj\ =\ this.seqObj,\ nextChar\ =\ -\/1,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00287}00287\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0,\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00288}00288\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00289}00289\ \ \ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00290}00290\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 0.\ Get\ next\ character.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00291}00291\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nextChar\ ===\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ ==\ str.length)\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00293}00293\ \ \ \ \ \ \ \ \ \ \ \ \ var\ uCode\ =\ str.charCodeAt(\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00294}00294\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00295}00295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00296}00296\ \ \ \ \ \ \ \ \ \ \ \ \ var\ uCode\ =\ nextChar;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00297}00297\ \ \ \ \ \ \ \ \ \ \ \ \ nextChar\ =\ -\/1;\ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00298}00298\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00299}00299\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00300}00300\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1.\ Handle\ surrogates.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00301}00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (0xD800\ <=\ uCode\ \&\&\ uCode\ <\ 0xE000)\ \{\ \textcolor{comment}{//\ Char\ is\ one\ of\ surrogates.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uCode\ <\ 0xDC00)\ \{\ \textcolor{comment}{//\ We've\ got\ lead\ surrogate.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00303}00303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leadSurrogate\ ===\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00304}00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leadSurrogate\ =\ uCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00305}00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00306}00306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00307}00307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leadSurrogate\ =\ uCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00308}00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Double\ lead\ surrogate\ found.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00309}00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00310}00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00311}00311\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ We've\ got\ trail\ surrogate.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (leadSurrogate\ !==\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00313}00313\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ 0x10000\ +\ (leadSurrogate\ -\/\ 0xD800)\ *\ 0x400\ +\ (uCode\ -\/\ 0xDC00);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ leadSurrogate\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00315}00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00316}00316\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incomplete\ surrogate\ pair\ -\/\ only\ trail\ surrogate\ found.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00319}00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00321}00321\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00322}00322\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (leadSurrogate\ !==\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incomplete\ surrogate\ pair\ -\/\ only\ lead\ surrogate\ found.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00324}00324\ \ \ \ \ \ \ \ \ \ \ \ \ nextChar\ =\ uCode;\ uCode\ =\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}};\ \textcolor{comment}{//\ Write\ an\ error,\ then\ current\ char.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ leadSurrogate\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00326}00326\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00327}00327\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00328}00328\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 2.\ Convert\ uCode\ character.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00329}00329\ \ \ \ \ \ \ \ \ var\ dbcsCode\ =\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00330}00330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (seqObj\ !==\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}}\ \&\&\ uCode\ !=\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})\ \{\ \textcolor{comment}{//\ We\ are\ in\ the\ middle\ of\ the\ sequence}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ var\ resCode\ =\ seqObj[uCode];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (typeof\ resCode\ ===\ \textcolor{stringliteral}{'object'})\ \{\ \textcolor{comment}{//\ Sequence\ continues.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seqObj\ =\ resCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00335}00335\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00336}00336\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (typeof\ resCode\ ==\ \textcolor{stringliteral}{'number'})\ \{\ \textcolor{comment}{//\ Sequence\ finished.\ Write\ it.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00337}00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dbcsCode\ =\ resCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00338}00338\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00339}00339\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (resCode\ ==\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})\ \{\ \textcolor{comment}{//\ Current\ character\ is\ not\ part\ of\ the\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00340}00340\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Try\ default\ character\ for\ this\ sequence}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00342}00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ resCode\ =\ seqObj[\mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{DEF\_CHAR}}];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (resCode\ !==\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00344}00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dbcsCode\ =\ resCode;\ \textcolor{comment}{//\ Found.\ Write\ it.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00345}00345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nextChar\ =\ uCode;\ \textcolor{comment}{//\ Current\ character\ will\ be\ written\ too\ in\ the\ next\ iteration.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00346}00346\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00347}00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00348}00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ What\ if\ we\ have\ no\ default?\ (resCode\ ==\ undefined)}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00349}00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Then,\ we\ should\ write\ first\ char\ of\ the\ sequence\ as-\/is\ and\ try\ the\ rest\ recursively.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00350}00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Didn't\ do\ it\ for\ now\ because\ no\ encoding\ has\ this\ situation\ yet.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00351}00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Currently,\ just\ skip\ the\ sequence\ and\ write\ current\ char.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00352}00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00353}00353\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00354}00354\ \ \ \ \ \ \ \ \ \ \ \ \ seqObj\ =\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00355}00355\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00356}00356\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ >=\ 0)\ \{\ \ \textcolor{comment}{//\ Regular\ character}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00357}00357\ \ \ \ \ \ \ \ \ \ \ \ \ var\ subtable\ =\ this.encodeTable[uCode\ >>\ 8];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00358}00358\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (subtable\ !==\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00359}00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dbcsCode\ =\ subtable[uCode\ \&\ 0xFF];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00360}00360\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00361}00361\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dbcsCode\ <=\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}})\ \{\ \textcolor{comment}{//\ Sequence\ start}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00362}00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seqObj\ =\ this.encodeTableSeq[\mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}-\/dbcsCode];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00363}00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00364}00364\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00365}00365\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00366}00366\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dbcsCode\ ==\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}}\ \&\&\ this.gb18030)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00367}00367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ GB18030\ algorithm\ to\ find\ character(s)\ to\ write.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00368}00368\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ idx\ =\ findIdx(this.gb18030.uChars,\ uCode);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00369}00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ !=\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00370}00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ var\ dbcsCode\ =\ this.gb18030.gbChars[idx]\ +\ (uCode\ -\/\ this.gb18030.uChars[idx]);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00371}00371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ 0x81\ +\ Math.floor(dbcsCode\ /\ 12600);\ dbcsCode\ =\ dbcsCode\ \%\ 12600;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00372}00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ 0x30\ +\ Math.floor(dbcsCode\ /\ 1260);\ dbcsCode\ =\ dbcsCode\ \%\ 1260;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00373}00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ 0x81\ +\ Math.floor(dbcsCode\ /\ 10);\ dbcsCode\ =\ dbcsCode\ \%\ 10;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00374}00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ 0x30\ +\ dbcsCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00375}00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00376}00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00377}00377\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00378}00378\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00379}00379\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00380}00380\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3.\ Write\ dbcsCode\ character.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00381}00381\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dbcsCode\ ===\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00382}00382\ \ \ \ \ \ \ \ \ \ \ \ \ dbcsCode\ =\ this.\mbox{\hyperlink{a01234_aeffa94a3dfe04104b28251048d914570_aeffa94a3dfe04104b28251048d914570}{defaultCharSingleByte}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00383}00383\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00384}00384\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dbcsCode\ <\ 0x100)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00385}00385\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00386}00386\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00387}00387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dbcsCode\ <\ 0x10000)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00388}00388\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode\ >>\ 8;\ \ \ \textcolor{comment}{//\ high\ byte}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00389}00389\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode\ \&\ 0xFF;\ \textcolor{comment}{//\ low\ byte}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00390}00390\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00391}00391\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00392}00392\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode\ >>\ 16;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00393}00393\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ (dbcsCode\ >>\ 8)\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00394}00394\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00395}00395\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00396}00396\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00397}00397\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00398}00398\ \ \ \ \ this.seqObj\ =\ seqObj;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00399}00399\ \ \ \ \ this.leadSurrogate\ =\ leadSurrogate;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00400}00400\ \ \ \ \ \textcolor{keywordflow}{return}\ newBuf.slice(0,\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}});}
\DoxyCodeLine{\Hypertarget{a01723_source_l00401}00401\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00402}00402\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00403}00403\ DBCSEncoder.prototype.end\ =\ \textcolor{keyword}{function}()\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00404}00404\ \ \ \ \ \textcolor{keywordflow}{if}\ (this.leadSurrogate\ ===\ -\/1\ \&\&\ this.seqObj\ ===\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})}
\DoxyCodeLine{\Hypertarget{a01723_source_l00405}00405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ All\ clean.\ Most\ often\ case.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00406}00406\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00407}00407\ \ \ \ \ var\ newBuf\ =\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}.alloc(10),\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ =\ 0;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00408}00408\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00409}00409\ \ \ \ \ \textcolor{keywordflow}{if}\ (this.seqObj)\ \{\ \textcolor{comment}{//\ We're\ in\ the\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00410}00410\ \ \ \ \ \ \ \ \ var\ dbcsCode\ =\ this.seqObj[\mbox{\hyperlink{a01723_a4f0d901e18d48a31a9114ecdc60e11c8_a4f0d901e18d48a31a9114ecdc60e11c8}{DEF\_CHAR}}];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00411}00411\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dbcsCode\ !==\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}})\ \{\ \textcolor{comment}{//\ Write\ beginning\ of\ the\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00412}00412\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dbcsCode\ <\ 0x100)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode\ >>\ 8;\ \ \ \textcolor{comment}{//\ high\ byte}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00417}00417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ dbcsCode\ \&\ 0xFF;\ \textcolor{comment}{//\ low\ byte}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00418}00418\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00419}00419\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ See\ todo\ above.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00421}00421\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00422}00422\ \ \ \ \ \ \ \ \ this.seqObj\ =\ \mbox{\hyperlink{a01198_a0b30f2887f0891ea5fed53d76282d2dc_a0b30f2887f0891ea5fed53d76282d2dc}{undefined}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00423}00423\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00424}00424\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00425}00425\ \ \ \ \ \textcolor{keywordflow}{if}\ (this.leadSurrogate\ !==\ -\/1)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00426}00426\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Incomplete\ surrogate\ pair\ -\/\ only\ lead\ surrogate\ found.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00427}00427\ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ this.\mbox{\hyperlink{a01234_aeffa94a3dfe04104b28251048d914570_aeffa94a3dfe04104b28251048d914570}{defaultCharSingleByte}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00428}00428\ \ \ \ \ \ \ \ \ this.leadSurrogate\ =\ -\/1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00429}00429\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00430}00430\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00431}00431\ \ \ \ \ \textcolor{keywordflow}{return}\ newBuf.slice(0,\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}});}
\DoxyCodeLine{\Hypertarget{a01723_source_l00432}00432\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00433}00433\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00434}00434\ \textcolor{comment}{//\ Export\ for\ testing}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00435}00435\ DBCSEncoder.prototype.findIdx\ =\ findIdx;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00436}00436\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00437}00437\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00438}00438\ \textcolor{comment}{//\ ==\ Decoder\ ==================================================================}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00439}00439\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00440}\mbox{\hyperlink{a01723_aa111899b7d948e60b1d84783a493a3e3_aa111899b7d948e60b1d84783a493a3e3}{00440}}\ \textcolor{keyword}{function}\ \mbox{\hyperlink{a01723_aa111899b7d948e60b1d84783a493a3e3_aa111899b7d948e60b1d84783a493a3e3}{DBCSDecoder}}(options,\ codec)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00441}00441\ \ \ \ \ \textcolor{comment}{//\ Decoder\ state}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00442}00442\ \ \ \ \ this.nodeIdx\ =\ 0;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00443}00443\ \ \ \ \ this.prevBuf\ =\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}.alloc(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00444}00444\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00445}00445\ \ \ \ \ \textcolor{comment}{//\ Static\ data}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00446}00446\ \ \ \ \ this.decodeTables\ =\ codec.decodeTables;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00447}00447\ \ \ \ \ this.decodeTableSeq\ =\ codec.decodeTableSeq;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00448}00448\ \ \ \ \ this.\mbox{\hyperlink{a01234_a03ca51949015b7c9734fd87bf26de60a_a03ca51949015b7c9734fd87bf26de60a}{defaultCharUnicode}}\ =\ codec.defaultCharUnicode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00449}00449\ \ \ \ \ this.gb18030\ =\ codec.gb18030;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00450}00450\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00451}00451\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00452}00452\ \mbox{\hyperlink{a01723_aa111899b7d948e60b1d84783a493a3e3_aa111899b7d948e60b1d84783a493a3e3}{DBCSDecoder}}.prototype.write\ =\ \textcolor{keyword}{function}(buf)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00453}00453\ \ \ \ \ var\ newBuf\ =\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}.alloc(buf.length*2),}
\DoxyCodeLine{\Hypertarget{a01723_source_l00454}00454\ \ \ \ \ \ \ \ \ nodeIdx\ =\ this.nodeIdx,\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00455}00455\ \ \ \ \ \ \ \ \ prevBuf\ =\ this.prevBuf,\ prevBufOffset\ =\ this.prevBuf.length,}
\DoxyCodeLine{\Hypertarget{a01723_source_l00456}00456\ \ \ \ \ \ \ \ \ seqStart\ =\ -\/this.prevBuf.length,\ \textcolor{comment}{//\ idx\ of\ the\ start\ of\ current\ parsed\ sequence.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00457}00457\ \ \ \ \ \ \ \ \ uCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00458}00458\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00459}00459\ \ \ \ \ \textcolor{keywordflow}{if}\ (prevBufOffset\ >\ 0)\ \textcolor{comment}{//\ Make\ prev\ buf\ overlap\ a\ little\ to\ make\ it\ easier\ to\ slice\ later.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00460}00460\ \ \ \ \ \ \ \ \ prevBuf\ =\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}.concat([prevBuf,\ buf.slice(0,\ 10)]);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00461}00461\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00462}00462\ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ 0,\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}\ =\ 0;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ <\ buf.length;\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00463}00463\ \ \ \ \ \ \ \ \ var\ curByte\ =\ (\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ >=\ 0)\ ?\ buf[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}]\ :\ prevBuf[\mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ +\ prevBufOffset];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00464}00464\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00465}00465\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lookup\ in\ current\ trie\ node.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00466}00466\ \ \ \ \ \ \ \ \ var\ uCode\ =\ this.decodeTables[nodeIdx][curByte];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00467}00467\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00468}00468\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uCode\ >=\ 0)\ \{\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00469}00469\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Normal\ character,\ just\ use\ it.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00470}00470\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00471}00471\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ ===\ \mbox{\hyperlink{a01723_a524a1c8a80b0c38ab9bf0c8d72cd6735_a524a1c8a80b0c38ab9bf0c8d72cd6735}{UNASSIGNED}})\ \{\ \textcolor{comment}{//\ Unknown\ char.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00472}00472\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Callback\ with\ seq.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00473}00473\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//var\ curSeq\ =\ (seqStart\ >=\ 0)\ ?\ buf.slice(seqStart,\ i+1)\ :\ prevBuf.slice(seqStart\ +\ prevBufOffset,\ i+1\ +\ prevBufOffset);}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00474}00474\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}\ =\ seqStart;\ \textcolor{comment}{//\ Try\ to\ parse\ again,\ after\ skipping\ first\ byte\ of\ the\ sequence\ ('i'\ will\ be\ incremented\ by\ 'for'\ cycle).}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00475}00475\ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ this.\mbox{\hyperlink{a01234_a03ca51949015b7c9734fd87bf26de60a_a03ca51949015b7c9734fd87bf26de60a}{defaultCharUnicode}}.charCodeAt(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00476}00476\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00477}00477\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ ===\ \mbox{\hyperlink{a01723_a50c7ef8c234abc12a6c40213ba962253_a50c7ef8c234abc12a6c40213ba962253}{GB18030\_CODE}})\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \ \ \ var\ curSeq\ =\ (seqStart\ >=\ 0)\ ?\ buf.slice(seqStart,\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}+1)\ :\ prevBuf.slice(seqStart\ +\ prevBufOffset,\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}+1\ +\ prevBufOffset);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00479}00479\ \ \ \ \ \ \ \ \ \ \ \ \ var\ ptr\ =\ (curSeq[0]-\/0x81)*12600\ +\ (curSeq[1]-\/0x30)*1260\ +\ (curSeq[2]-\/0x81)*10\ +\ (curSeq[3]-\/0x30);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00480}00480\ \ \ \ \ \ \ \ \ \ \ \ \ var\ idx\ =\ findIdx(this.gb18030.gbChars,\ ptr);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00481}00481\ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ this.gb18030.uChars[idx]\ +\ ptr\ -\/\ this.gb18030.gbChars[idx];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00482}00482\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00483}00483\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ <=\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}})\ \{\ \textcolor{comment}{//\ Go\ to\ next\ trie\ node.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00484}00484\ \ \ \ \ \ \ \ \ \ \ \ \ nodeIdx\ =\ \mbox{\hyperlink{a01723_a7097df03d19f08d03aef2a303d01c402_a7097df03d19f08d03aef2a303d01c402}{NODE\_START}}\ -\/\ uCode;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00485}00485\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00486}00486\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00487}00487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (uCode\ <=\ \mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}})\ \{\ \textcolor{comment}{//\ Output\ a\ sequence\ of\ chars.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ var\ seq\ =\ this.decodeTableSeq[\mbox{\hyperlink{a01723_a13f5d00100c8407b8c5fbb28683260b8_a13f5d00100c8407b8c5fbb28683260b8}{SEQ\_START}}\ -\/\ uCode];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00489}00489\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (var\ k\ =\ 0;\ k\ <\ seq.length\ -\/\ 1;\ k++)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00490}00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ seq[k];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00491}00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ uCode\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00492}00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ uCode\ >>\ 8;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00493}00493\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00494}00494\ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ seq[seq.length-\/1];}
\DoxyCodeLine{\Hypertarget{a01723_source_l00495}00495\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00496}00496\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00497}00497\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{a01276_ab90d95850f9ba1903a6704f6fa8eccb6_ab90d95850f9ba1903a6704f6fa8eccb6}{Error}}(\textcolor{stringliteral}{"{}iconv-\/lite\ internal\ error:\ invalid\ decoding\ table\ value\ "{}}\ +\ uCode\ +\ \textcolor{stringliteral}{"{}\ at\ "{}}\ +\ nodeIdx\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ curByte);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00498}00498\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00499}00499\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Write\ the\ character\ to\ buffer,\ handling\ higher\ planes\ using\ surrogate\ pair.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00500}00500\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uCode\ >\ 0xFFFF)\ \{\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00501}00501\ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ -\/=\ 0x10000;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00502}00502\ \ \ \ \ \ \ \ \ \ \ \ \ var\ uCodeLead\ =\ 0xD800\ +\ Math.floor(uCode\ /\ 0x400);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00503}00503\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ uCodeLead\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00504}00504\ \ \ \ \ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ uCodeLead\ >>\ 8;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00505}00505\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00506}00506\ \ \ \ \ \ \ \ \ \ \ \ \ uCode\ =\ 0xDC00\ +\ uCode\ \%\ 0x400;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00507}00507\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00508}00508\ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ uCode\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00509}00509\ \ \ \ \ \ \ \ \ newBuf[\mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}++]\ =\ uCode\ >>\ 8;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00510}00510\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00511}00511\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reset\ trie\ node.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00512}00512\ \ \ \ \ \ \ \ \ nodeIdx\ =\ 0;\ seqStart\ =\ \mbox{\hyperlink{a00197_a5e25b1d1bed9ab5f3174b76d6a722180_a5e25b1d1bed9ab5f3174b76d6a722180}{i}}+1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00513}00513\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00514}00514\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00515}00515\ \ \ \ \ this.nodeIdx\ =\ nodeIdx;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00516}00516\ \ \ \ \ this.prevBuf\ =\ (seqStart\ >=\ 0)\ ?\ buf.slice(seqStart)\ :\ prevBuf.slice(seqStart\ +\ prevBufOffset);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00517}00517\ \ \ \ \ \textcolor{keywordflow}{return}\ newBuf.slice(0,\ \mbox{\hyperlink{a00059_aeea493c7afe8b905d89d2ef3ac307efb_aeea493c7afe8b905d89d2ef3ac307efb}{j}}).toString(\textcolor{stringliteral}{'ucs2'});}
\DoxyCodeLine{\Hypertarget{a01723_source_l00518}00518\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00519}00519\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00520}00520\ \mbox{\hyperlink{a01723_aa111899b7d948e60b1d84783a493a3e3_aa111899b7d948e60b1d84783a493a3e3}{DBCSDecoder}}.prototype.end\ =\ \textcolor{keyword}{function}()\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00521}00521\ \ \ \ \ var\ ret\ =\ \textcolor{stringliteral}{''};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00522}00522\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00523}00523\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ parse\ all\ remaining\ chars.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00524}00524\ \ \ \ \ \textcolor{keywordflow}{while}\ (this.prevBuf.length\ >\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00525}00525\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ 1\ character\ in\ the\ buffer.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00526}00526\ \ \ \ \ \ \ \ \ ret\ +=\ this.\mbox{\hyperlink{a01234_a03ca51949015b7c9734fd87bf26de60a_a03ca51949015b7c9734fd87bf26de60a}{defaultCharUnicode}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00527}00527\ \ \ \ \ \ \ \ \ var\ buf\ =\ this.prevBuf.slice(1);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00528}00528\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00529}00529\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Parse\ remaining\ as\ usual.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00530}00530\ \ \ \ \ \ \ \ \ this.prevBuf\ =\ \mbox{\hyperlink{a01723_a6e9de2d16b02dc274208bfcc1914d7f4_a6e9de2d16b02dc274208bfcc1914d7f4}{Buffer}}.alloc(0);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00531}00531\ \ \ \ \ \ \ \ \ this.nodeIdx\ =\ 0;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00532}00532\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buf.length\ >\ 0)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00533}00533\ \ \ \ \ \ \ \ \ \ \ \ \ ret\ +=\ this.\mbox{\hyperlink{a01759_ac84eb1c937f703f14c9844357248991b_ac84eb1c937f703f14c9844357248991b}{write}}(buf);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00534}00534\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00535}00535\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00536}00536\ \ \ \ \ this.nodeIdx\ =\ 0;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00537}00537\ \ \ \ \ \textcolor{keywordflow}{return}\ ret;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00538}00538\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00539}00539\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00540}00540\ \textcolor{comment}{//\ Binary\ search\ for\ GB18030.\ Returns\ largest\ i\ such\ that\ table[i]\ <=\ val.}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00541}00541\ \textcolor{keyword}{function}\ findIdx(table,\ val)\ \{}
\DoxyCodeLine{\Hypertarget{a01723_source_l00542}00542\ \ \ \ \ \textcolor{keywordflow}{if}\ (table[0]\ >\ val)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00543}00543\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00544}00544\ }
\DoxyCodeLine{\Hypertarget{a01723_source_l00545}00545\ \ \ \ \ var\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ =\ 0,\ \mbox{\hyperlink{a00197_a07c0e0a63b5b484807c0331c78558c9e_a07c0e0a63b5b484807c0331c78558c9e}{r}}\ =\ table.length;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00546}00546\ \ \ \ \ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ <\ \mbox{\hyperlink{a00197_a07c0e0a63b5b484807c0331c78558c9e_a07c0e0a63b5b484807c0331c78558c9e}{r}}-\/1)\ \{\ \textcolor{comment}{//\ always\ table[l]\ <=\ val\ <\ table[r]}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00547}00547\ \ \ \ \ \ \ \ \ var\ mid\ =\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ +\ Math.floor((\mbox{\hyperlink{a00197_a07c0e0a63b5b484807c0331c78558c9e_a07c0e0a63b5b484807c0331c78558c9e}{r}}-\/\mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}+1)/2);}
\DoxyCodeLine{\Hypertarget{a01723_source_l00548}00548\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (table[mid]\ <=\ val)}
\DoxyCodeLine{\Hypertarget{a01723_source_l00549}00549\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}}\ =\ mid;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00550}00550\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00551}00551\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{a00197_a07c0e0a63b5b484807c0331c78558c9e_a07c0e0a63b5b484807c0331c78558c9e}{r}}\ =\ mid;}
\DoxyCodeLine{\Hypertarget{a01723_source_l00552}00552\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00553}00553\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{a00572_ae5e71a2600e8891c54854be157cc6626_ae5e71a2600e8891c54854be157cc6626}{l}};}
\DoxyCodeLine{\Hypertarget{a01723_source_l00554}00554\ \}}
\DoxyCodeLine{\Hypertarget{a01723_source_l00555}00555\ }

\end{DoxyCode}
