\doxysection{finalhandler}
\hypertarget{a00895}{}\label{a00895}\index{finalhandler@{finalhandler}}
\label{a00895_autotoc_md1079}%
\Hypertarget{a00895_autotoc_md1079}%


\href{https://npmjs.org/package/finalhandler}{\texttt{ }} \href{https://npmjs.org/package/finalhandler}{\texttt{ }} \href{https://nodejs.org/en/download}{\texttt{ }} \href{https://github.com/pillarjs/finalhandler/actions/workflows/ci.yml}{\texttt{ }} \href{https://coveralls.io/r/pillarjs/finalhandler?branch=master}{\texttt{ }}

Node.\+js function to invoke as the final step to respond to HTTP request.\hypertarget{a00895_autotoc_md1080}{}\doxysubsection{\texorpdfstring{Installation}{Installation}}\label{a00895_autotoc_md1080}
This is a \href{https://nodejs.org/en/}{\texttt{ Node.\+js}} module available through the \href{https://www.npmjs.com/}{\texttt{ npm registry}}. Installation is done using the \href{https://docs.npmjs.com/getting-started/installing-npm-packages-locally}{\texttt{ {\ttfamily npm install} command}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ install\ finalhandler}

\end{DoxyCode}
\hypertarget{a00895_autotoc_md1081}{}\doxysubsection{\texorpdfstring{API}{API}}\label{a00895_autotoc_md1081}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ finalhandler\ =\ require(\textcolor{stringliteral}{'finalhandler'})}

\end{DoxyCode}
\hypertarget{a00895_autotoc_md1082}{}\doxysubsubsection{\texorpdfstring{finalhandler(req, res, \mbox{[}options\mbox{]})}{finalhandler(req, res, \mbox{[}options\mbox{]})}}\label{a00895_autotoc_md1082}
Returns function to be invoked as the final step for the given {\ttfamily req} and {\ttfamily res}. This function is to be invoked as {\ttfamily \doxylink{a00572_a2287243da4967181305b31f0ac827b66_a2287243da4967181305b31f0ac827b66}{fn(err)}}. If {\ttfamily err} is falsy, the handler will write out a 404 response to the {\ttfamily res}. If it is truthy, an error response will be written out to the {\ttfamily res} or {\ttfamily res} will be terminated if a response has already started.

When an error is written, the following information is added to the response\+:


\begin{DoxyItemize}
\item The {\ttfamily res.\+status\+Code} is set from {\ttfamily err.\+status} (or {\ttfamily err.\+status\+Code}). If this value is outside the 4xx or 5xx range, it will be set to 500.
\item The {\ttfamily res.\+status\+Message} is set according to the status code.
\item The body will be the HTML of the status code message if {\ttfamily env} is `\textquotesingle{}production'{\ttfamily , otherwise will be}err.\+stack{\ttfamily .}
\item {\ttfamily Any headers specified in an}err.\+headers\`{} object.
\end{DoxyItemize}

The final handler will also unpipe anything from {\ttfamily req} when it is invoked.\hypertarget{a00895_autotoc_md1083}{}\doxysubsubsubsection{\texorpdfstring{options.\+env}{options.\+env}}\label{a00895_autotoc_md1083}
By default, the environment is determined by {\ttfamily NODE\+\_\+\+ENV} variable, but it can be overridden by this option.\hypertarget{a00895_autotoc_md1084}{}\doxysubsubsubsection{\texorpdfstring{options.\+onerror}{options.\+onerror}}\label{a00895_autotoc_md1084}
Provide a function to be called with the {\ttfamily err} when it exists. Can be used for writing errors to a central location without excessive function generation. Called as {\ttfamily onerror(err, req, res)}.\hypertarget{a00895_autotoc_md1085}{}\doxysubsection{\texorpdfstring{Examples}{Examples}}\label{a00895_autotoc_md1085}
\hypertarget{a00895_autotoc_md1086}{}\doxysubsubsection{\texorpdfstring{always 404}{always 404}}\label{a00895_autotoc_md1086}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ finalhandler\ =\ require(\textcolor{stringliteral}{'finalhandler'})}
\DoxyCodeLine{var\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}\ =\ require('\mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ server\ =\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}.\mbox{\hyperlink{a01267_a1691cdb731c5313b41e7ecdd05081e96_a1691cdb731c5313b41e7ecdd05081e96}{createServer}}(function\ (\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})\ \{}
\DoxyCodeLine{\ \ var\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}\ =\ finalhandler(\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})}
\DoxyCodeLine{\ \ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}()}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{server.listen(3000)}

\end{DoxyCode}
\hypertarget{a00895_autotoc_md1087}{}\doxysubsubsection{\texorpdfstring{perform simple action}{perform simple action}}\label{a00895_autotoc_md1087}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ finalhandler\ =\ require(\textcolor{stringliteral}{'finalhandler'})}
\DoxyCodeLine{var\ \mbox{\hyperlink{a00128_aebcdd70130f7e0b00b39cc981ab0bab0_aebcdd70130f7e0b00b39cc981ab0bab0}{fs}}\ =\ require('\mbox{\hyperlink{a00128_aebcdd70130f7e0b00b39cc981ab0bab0_aebcdd70130f7e0b00b39cc981ab0bab0}{fs}}')}
\DoxyCodeLine{var\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}\ =\ require('\mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ server\ =\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}.\mbox{\hyperlink{a01267_a1691cdb731c5313b41e7ecdd05081e96_a1691cdb731c5313b41e7ecdd05081e96}{createServer}}(function\ (\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})\ \{}
\DoxyCodeLine{\ \ var\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}\ =\ finalhandler(\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \mbox{\hyperlink{a00128_aebcdd70130f7e0b00b39cc981ab0bab0_aebcdd70130f7e0b00b39cc981ab0bab0}{fs}}.readFile(\textcolor{stringliteral}{'index.html'},\ \textcolor{keyword}{function}\ (err,\ buf)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (err)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}(err)}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}}.setHeader(\textcolor{stringliteral}{'Content-\/Type'},\ \textcolor{stringliteral}{'text/html'})}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}}.end(buf)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{server.listen(3000)}

\end{DoxyCode}
\hypertarget{a00895_autotoc_md1088}{}\doxysubsubsection{\texorpdfstring{use with middleware-\/style functions}{use with middleware-\/style functions}}\label{a00895_autotoc_md1088}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ finalhandler\ =\ require(\textcolor{stringliteral}{'finalhandler'})}
\DoxyCodeLine{var\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}\ =\ require('\mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}')}
\DoxyCodeLine{var\ serveStatic\ =\ require('serve-\/static')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ serve\ =\ serveStatic('public')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ server\ =\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}.\mbox{\hyperlink{a01267_a1691cdb731c5313b41e7ecdd05081e96_a1691cdb731c5313b41e7ecdd05081e96}{createServer}}(function\ (\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})\ \{}
\DoxyCodeLine{\ \ var\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}\ =\ finalhandler(\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})}
\DoxyCodeLine{\ \ serve(\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}},\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}})}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{server.listen(3000)}

\end{DoxyCode}
\hypertarget{a00895_autotoc_md1089}{}\doxysubsubsection{\texorpdfstring{keep log of all errors}{keep log of all errors}}\label{a00895_autotoc_md1089}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ finalhandler\ =\ require(\textcolor{stringliteral}{'finalhandler'})}
\DoxyCodeLine{var\ \mbox{\hyperlink{a00128_aebcdd70130f7e0b00b39cc981ab0bab0_aebcdd70130f7e0b00b39cc981ab0bab0}{fs}}\ =\ require('\mbox{\hyperlink{a00128_aebcdd70130f7e0b00b39cc981ab0bab0_aebcdd70130f7e0b00b39cc981ab0bab0}{fs}}')}
\DoxyCodeLine{var\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}\ =\ require('\mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ server\ =\ \mbox{\hyperlink{a00101_a55f22d498ca401fddca364855629d1d3_a55f22d498ca401fddca364855629d1d3}{http}}.\mbox{\hyperlink{a01267_a1691cdb731c5313b41e7ecdd05081e96_a1691cdb731c5313b41e7ecdd05081e96}{createServer}}(function\ (\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}})\ \{}
\DoxyCodeLine{\ \ var\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}\ =\ finalhandler(\mbox{\hyperlink{a00104_a42c43c76081a7df8ae2954f16ee9338b_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}},\ \{\ onerror:\ logerror\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \mbox{\hyperlink{a00128_aebcdd70130f7e0b00b39cc981ab0bab0_aebcdd70130f7e0b00b39cc981ab0bab0}{fs}}.readFile(\textcolor{stringliteral}{'index.html'},\ function\ (err,\ buf)\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (err)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{a01810_a006c822566f0ebf86500557e24565697_a006c822566f0ebf86500557e24565697}{done}}(err)}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}}.setHeader(\textcolor{stringliteral}{'Content-\/Type'},\ \textcolor{stringliteral}{'text/html'})}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{a00104_abde3c35e3bb7e5225dd7f234c685329c_abde3c35e3bb7e5225dd7f234c685329c}{res}}.end(buf)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{server.listen(3000)}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{function}\ logerror\ (err)\ \{}
\DoxyCodeLine{\ \ console.error(err.stack\ ||\ err.toString())}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{a00895_autotoc_md1090}{}\doxysubsection{\texorpdfstring{License}{License}}\label{a00895_autotoc_md1090}
\mbox{[}MIT\mbox{]}(LICENSE) 