<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Documentacion WEB: sqlstring</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="../../darkmode_toggle.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Documentacion WEB<span id="projectnumber">&#160;1</span>
   </div>
  </td>
 </tr>
   <tr><td colspan="2">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Buscar" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d7/d98/a00983.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Cargando...</div>
<div class="SRStatus" id="Searching">Buscando...</div>
<div class="SRStatus" id="NoMatches">Nada coincide</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">sqlstring</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2410"></a></p>
<p><a href="https://npmjs.org/package/sqlstring"><img src="https://img.shields.io/npm/v/sqlstring.svg" alt="NPM Version" style="pointer-events: none;" class="inline"/></a> <a href="https://npmjs.org/package/sqlstring"><img src="https://img.shields.io/npm/dm/sqlstring.svg" alt="NPM Downloads" style="pointer-events: none;" class="inline"/></a> <a href="https://nodejs.org/en/download"><img src="https://img.shields.io/node/v/sqlstring.svg" alt="Node.js Version" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/mysqljs/sqlstring/actions/workflows/ci.yml"><img src="https://img.shields.io/github/workflow/status/mysqljs/sqlstring/ci/master?label=build" alt="Build Status" class="inline"/></a> <a href="https://coveralls.io/r/mysqljs/sqlstring?branch=master"><img src="https://img.shields.io/coveralls/mysqljs/sqlstring/master.svg" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a></p>
<p>Simple SQL escape and format for MySQL</p>
<h1><a class="anchor" id="autotoc_md2411"></a>
Install</h1>
<div class="fragment"><div class="line">$ npm install sqlstring</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2412"></a>
Usage</h1>
<div class="fragment"><div class="line">var <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a> = require(<span class="stringliteral">&#39;sqlstring&#39;</span>);</div>
<div class="ttc" id="aa01267_a268f67bb058cd36c3821a17e40390459_html_a268f67bb058cd36c3821a17e40390459"><div class="ttname"><a href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a></div><div class="ttdeci">const SqlString</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d41/a01267_source.html#l00003">node_modules/mysql2/index.js:3</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2413"></a>
Escaping query values</h2>
<p><b>Caution</b> These methods of escaping values only works when the <a href="https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_no_backslash_escapes">NO_BACKSLASH_ESCAPES</a> SQL mode is disabled (which is the default state for MySQL servers).</p>
<p>In order to avoid SQL Injection attacks, you should always escape any user provided data before using it inside a SQL query. You can do so using the <code>SqlString.escape()</code> method:</p>
<div class="fragment"><div class="line">var userId = <span class="stringliteral">&#39;some user provided value&#39;</span>;</div>
<div class="line">var sql    = <span class="stringliteral">&#39;SELECT * FROM users WHERE id = &#39;</span> + <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.escape(userId);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM users WHERE id = &#39;some user provided value&#39;</span></div>
</div><!-- fragment --><p>Alternatively, you can use <code>?</code> characters as placeholders for values you would like to have escaped like this:</p>
<div class="fragment"><div class="line">var userId = 1;</div>
<div class="line">var sql    = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;SELECT * FROM users WHERE id = ?&#39;</span>, [userId]);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM users WHERE id = 1</span></div>
</div><!-- fragment --><p>Multiple placeholders are mapped to values in the same order as passed. For example, in the following query <code>foo</code> equals <code>a</code>, <code>bar</code> equals <code>b</code>, <code>baz</code> equals <code>c</code>, and <code>id</code> will be <code>userId</code>:</p>
<div class="fragment"><div class="line">var userId = 1;</div>
<div class="line">var sql    = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;UPDATE users SET foo = ?, bar = ?, baz = ? WHERE id = ?&#39;</span>,</div>
<div class="line">  [<span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;b&#39;</span>, <span class="charliteral">&#39;c&#39;</span>, userId]);</div>
<div class="line">console.log(sql); <span class="comment">// UPDATE users SET foo = &#39;a&#39;, bar = &#39;b&#39;, baz = &#39;c&#39; WHERE id = 1</span></div>
</div><!-- fragment --><p>This looks similar to prepared statements in MySQL, however it really just uses the same <code>SqlString.escape()</code> method internally.</p>
<p><b>Caution</b> This also differs from prepared statements in that all <code>?</code> are replaced, even those contained in comments and strings.</p>
<p>Different value types are escaped differently, here is how:</p>
<ul>
<li>Numbers are left untouched</li>
<li>Booleans are converted to <code>true</code> / <code>false</code></li>
<li>Date objects are converted to &lsquo;'YYYY-mm-dd HH:ii:ss&rsquo;<code>strings</code></li>
<li><code>Buffers are converted to hex strings, e.g.</code>X'0fa5'<code></code></li>
<li><code>Strings are safely escaped</code></li>
<li><code>Arrays are turned into list, e.g.</code>['a', 'b']<code>turns into</code>'a', 'b'<code></code></li>
<li><code>Nested arrays are turned into grouped lists (for bulk inserts), e.g.</code>[['a', 'b'], ['c', 'd']]<code>turns into</code>('a', 'b'), ('c', 'd')<code></code></li>
<li><code>Objects that have a</code>toSqlString<code>method will have</code>.toSqlString()<code>called and the returned value is used as the raw SQL.</code></li>
<li><code>Objects are turned into</code>key = 'val'<code>pairs for each enumerable property on the object. If the property's value is a function, it is skipped; if the property's value is an object, <a class="el" href="../../dc/d98/a01177_a7c9b2c6889147a97101a5409709b8d91.html#a7c9b2c6889147a97101a5409709b8d91">toString()</a> is called on it and the returned value is used. *</code>undefined<code>/</code>null<code>are converted to</code>NULL<code> *</code>NaN<code>/</code>Infinity` are left as-is. MySQL does not support these, and trying to insert them as values will trigger MySQL errors until they implement support.</li>
</ul>
<p>You may have noticed that this escaping allows you to do neat things like this:</p>
<div class="fragment"><div class="line">var post  = {id: 1, title: <span class="stringliteral">&#39;Hello MySQL&#39;</span>};</div>
<div class="line">var sql = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;INSERT INTO posts SET ?&#39;</span>, post);</div>
<div class="line">console.log(sql); <span class="comment">// INSERT INTO posts SET `id` = 1, `title` = &#39;Hello MySQL&#39;</span></div>
</div><!-- fragment --><p>And the <code>toSqlString</code> method allows you to form complex queries with functions:</p>
<div class="fragment"><div class="line">var CURRENT_TIMESTAMP = { toSqlString: <span class="keyword">function</span>() { <span class="keywordflow">return</span> <span class="stringliteral">&#39;CURRENT_TIMESTAMP()&#39;</span>; } };</div>
<div class="line">var sql = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;UPDATE posts SET modified = ? WHERE id = ?&#39;</span>, [CURRENT_TIMESTAMP, 42]);</div>
<div class="line">console.log(sql); <span class="comment">// UPDATE posts SET modified = CURRENT_TIMESTAMP() WHERE id = 42</span></div>
</div><!-- fragment --><p>To generate objects with a <code>toSqlString</code> method, the <code>SqlString.raw()</code> method can be used. This creates an object that will be left un-touched when using in a <code>?</code> placeholder, useful for using functions as dynamic values:</p>
<p><b>Caution</b> The string provided to <code>SqlString.raw()</code> will skip all escaping functions when used, so be careful when passing in unvalidated input.</p>
<div class="fragment"><div class="line">var CURRENT_TIMESTAMP = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.raw(<span class="stringliteral">&#39;CURRENT_TIMESTAMP()&#39;</span>);</div>
<div class="line">var sql = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;UPDATE posts SET modified = ? WHERE id = ?&#39;</span>, [CURRENT_TIMESTAMP, 42]);</div>
<div class="line">console.log(sql); <span class="comment">// UPDATE posts SET modified = CURRENT_TIMESTAMP() WHERE id = 42</span></div>
</div><!-- fragment --><p>If you feel the need to escape queries by yourself, you can also use the escaping function directly:</p>
<div class="fragment"><div class="line">var sql = <span class="stringliteral">&#39;SELECT * FROM posts WHERE title=&#39;</span> + <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.escape(<span class="stringliteral">&#39;Hello MySQL&#39;</span>);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM posts WHERE title=&#39;Hello MySQL&#39;</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2414"></a>
Escaping query identifiers</h2>
<p>If you can't trust an SQL identifier (database / table / column name) because it is provided by a user, you should escape it with <code>SqlString.escapeId(identifier)</code> like this:</p>
<div class="fragment"><div class="line">var sorter = <span class="stringliteral">&#39;date&#39;</span>;</div>
<div class="line">var sql    = <span class="stringliteral">&#39;SELECT * FROM posts ORDER BY &#39;</span> + <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.escapeId(sorter);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM posts ORDER BY `date`</span></div>
</div><!-- fragment --><p>It also supports adding qualified identifiers. It will escape both parts.</p>
<div class="fragment"><div class="line">var sorter = <span class="stringliteral">&#39;date&#39;</span>;</div>
<div class="line">var sql    = <span class="stringliteral">&#39;SELECT * FROM posts ORDER BY &#39;</span> + <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.escapeId(<span class="stringliteral">&#39;posts.&#39;</span> + sorter);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM posts ORDER BY `posts`.`date`</span></div>
</div><!-- fragment --><p>If you do not want to treat <code>.</code> as qualified identifiers, you can set the second argument to <code>true</code> in order to keep the string as a literal identifier:</p>
<div class="fragment"><div class="line">var sorter = <span class="stringliteral">&#39;date.2&#39;</span>;</div>
<div class="line">var sql    = <span class="stringliteral">&#39;SELECT * FROM posts ORDER BY &#39;</span> + <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.escapeId(sorter, <span class="keyword">true</span>);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM posts ORDER BY `date.2`</span></div>
</div><!-- fragment --><p>Alternatively, you can use <code>??</code> characters as placeholders for identifiers you would like to have escaped like this:</p>
<div class="fragment"><div class="line">var userId = 1;</div>
<div class="line">var columns = [<span class="stringliteral">&#39;username&#39;</span>, <span class="stringliteral">&#39;email&#39;</span>];</div>
<div class="line">var sql     = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;SELECT ?? FROM ?? WHERE id = ?&#39;</span>, [columns, <span class="stringliteral">&#39;users&#39;</span>, userId]);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT `username`, `email` FROM `users` WHERE id = 1</span></div>
</div><!-- fragment --><p> <b>Please note that this last character sequence is experimental and syntax might change</b></p>
<p>When you pass an Object to <code>.<a class="el" href="../../d4/d41/a01267_a5185c2e0b8e6a5224458b2e5e6ed26e8.html#a5185c2e0b8e6a5224458b2e5e6ed26e8">escape()</a></code> or <code>.<a class="el" href="../../d2/dd7/a01108_a9027c5af360d5ef99cc9906449e85a27.html#a9027c5af360d5ef99cc9906449e85a27">format()</a></code>, <code>.<a class="el" href="../../d4/d41/a01267_a2bc45c52ec0a6a585708d9bea92911da.html#a2bc45c52ec0a6a585708d9bea92911da">escapeId()</a></code> is used to avoid SQL injection in object keys.</p>
<h2><a class="anchor" id="autotoc_md2415"></a>
Formatting queries</h2>
<p>You can use <code>SqlString.format</code> to prepare a query with multiple insertion points, utilizing the proper escaping for ids and values. <a class="el" href="../../d3/d69/a00844.html" title="Constructs a 64 bit two&#39;s-complement integer, given its low and high 32 bit values as signed integers...">A</a> simple example of this follows:</p>
<div class="fragment"><div class="line">var userId  = 1;</div>
<div class="line">var inserts = [<span class="stringliteral">&#39;users&#39;</span>, <span class="stringliteral">&#39;id&#39;</span>, userId];</div>
<div class="line">var sql     = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;SELECT * FROM ?? WHERE ?? = ?&#39;</span>, inserts);</div>
<div class="line">console.log(sql); <span class="comment">// SELECT * FROM `users` WHERE `id` = 1</span></div>
</div><!-- fragment --><p>Following this you then have a valid, escaped query that you can then send to the database safely. This is useful if you are looking to prepare the query before actually sending it to the database. You also have the option (but are not required) to pass in <code>stringifyObject</code> and <code>timeZone</code>, allowing you provide a custom means of turning objects into strings, as well as a location-specific/timezone-aware <code>Date</code>.</p>
<p>This can be further combined with the <code>SqlString.raw()</code> helper to generate SQL that includes MySQL functions as dynamic vales:</p>
<div class="fragment"><div class="line">var userId = 1;</div>
<div class="line">var data   = { email: <span class="stringliteral">&#39;foobar@example.com&#39;</span>, modified: <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.raw(<span class="stringliteral">&#39;NOW()&#39;</span>) };</div>
<div class="line">var sql    = <a class="code hl_variable" href="../../d4/d41/a01267_a268f67bb058cd36c3821a17e40390459.html#a268f67bb058cd36c3821a17e40390459">SqlString</a>.format(<span class="stringliteral">&#39;UPDATE ?? SET ? WHERE `id` = ?&#39;</span>, [<span class="stringliteral">&#39;users&#39;</span>, data, userId]);</div>
<div class="line">console.log(sql); <span class="comment">// UPDATE `users` SET `email` = &#39;foobar@example.com&#39;, `modified` = NOW() WHERE `id` = 1</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2416"></a>
License</h1>
<p>[MIT](LICENSE) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generado por <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
